<!-- /**
 * @license
 * APLIKASI REKAM MEDIS BERBASIS BLOCKCHAIN dengan ALGORITMA KONSENSUS PROOF-of-WORK
 * Copyright (c) 2025 Muhammad As'ad Muhibbin Akbar
 * Licensed under the MIT License.
 * See LICENSE file for details.
 * See LICENSE file for details.
 */ -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Medical Record - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --primary: #3f51b5;
            --primary-dark: #303f9f;
            --primary-light: #e8eaf6;
            --secondary: #f8f9fa;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --info: #2196f3;
            --text-dark: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #e0e6ed;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --sidebar-width: 280px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fb;
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            height: 100vh;
            position: fixed;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .sidebar-header h3 {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .menu-item:hover {
            background: var(--primary-light);
            color: var(--primary);
        }
        
        .menu-item.active {
            background: var(--primary-light);
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: all 0.3s;
        }
        
        /* Navbar Styles */
        .navbar {
            background: white;
            padding: 15px 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 99;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .navbar-brand {
            font-weight: 700;
            color: var(--text-dark);
            font-size: 1.3rem;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
        }
        
        .user-menu .dropdown-toggle {
            display: flex;
            align-items: center;
            color: var(--text-dark);
            text-decoration: none;
        }
        
        .user-menu .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        /* Content Styles */
        .content {
            padding: 25px;
        }
        
        .section-title {
            font-weight: 700;
            margin-bottom: 25px;
            color: var(--text-dark);
            position: relative;
            padding-bottom: 10px;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--primary);
            border-radius: 2px;
        }
        
        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card.doctors {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }
        
        .stat-card.patients {
            background: linear-gradient(135deg, var(--success), #66bb6a);
            color: white;
        }
        
        .stat-card.records {
            background: linear-gradient(135deg, var(--warning), #ffb74d);
            color: white;
        }
        
        .stat-card.blocks {
            background: linear-gradient(135deg, var(--info), #64b5f6);
            color: white;
        }
        
        .stat-card h6 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            overflow: hidden;
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            padding: 18px 25px;
            font-weight: 600;
            color: var(--text-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header .card-title {
            margin: 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
        }
        
        .card-header .card-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .card-body {
            padding: 25px;
        }
        
        /* Tables */
        .table {
            margin-bottom: 0;
        }
        
        .table th {
            font-weight: 600;
            background-color: var(--secondary);
            border-top: none;
        }
        
        .table td, .table th {
            vertical-align: middle;
            padding: 12px 16px;
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: var(--primary);
            border: none;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(63, 81, 181, 0.3);
        }
        
        .btn-outline-primary {
            border: 2px solid var(--primary);
            color: var(--primary);
            background: transparent;
        }
        
        .btn-outline-primary:hover {
            background: var(--primary);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 0.875rem;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-dark);
        }
        
        .form-control, .form-select {
            padding: 12px 15px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            transition: all 0.3s;
            width: 100%;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(63, 81, 181, 0.2);
            outline: none;
        }
        
        /* Badges */
        .badge {
            font-weight: 600;
            padding: 8px 12px;
            border-radius: 8px;
        }
        
        /* Hash Display */
        .hash-display {
            font-family: monospace;
            word-break: break-all;
            font-size: 0.85rem;
            color: var(--text-light);
            background: #f5f5f5;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #dcdcdc;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                z-index: 1000;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .card-header .btn {
                margin-top: 10px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>MedicalRecord</h3>
            <p>Blockchain System</p>
        </div>
        
        <div class="sidebar-menu">
            <a href="#" class="menu-item active" id="dashboardLink">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="menu-item" id="dokterLink">
                <i class="fas fa-user-md"></i>
                <span>Manajemen Dokter</span>
            </a>
            <a href="#" class="menu-item" id="pasienLink">
                <i class="fas fa-users"></i>
                <span>Manajemen Pasien</span>
            </a>
            <a href="#" class="menu-item" id="blockchainLink">
                <i class="fas fa-link"></i>
                <span>Blockchain Explorer</span>
            </a>
            <a href="#" class="menu-item" id="settingsLink">
                <i class="fas fa-cog"></i>
                <span>Pengaturan</span>
            </a>
            <a href="#" class="menu-item" id="logoutLink">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Navbar -->
        <nav class="navbar">
            <button class="btn btn-sm btn-primary me-3" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="navbar-brand">Admin Dashboard</div>
            <div class="user-menu">
                <a href="#" class="dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
                    <div class="user-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <span>Admin</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li><a class="dropdown-item" href="#" id="profileLink"><i class="fas fa-user me-2"></i> Profile</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" id="logoutDropdown"><i class="fas fa-sign-out-alt me-2"></i> Logout</a></li>
                </ul>
            </div>
        </nav>
        
        <!-- Content Area -->
        <div class="content">
            <!-- Dashboard Content -->
            <div id="dashboardContent">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Dashboard Admin</h2>
                    <div class="text-muted">Last updated: <span id="lastUpdated"></span></div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card doctors">
                        <h6>Total Dokter</h6>
                        <div class="value" id="totalDokter">0</div>
                        <div class="mt-2">
                            <a href="#" class="text-white" id="viewDokterLink">View Details <i class="fas fa-chevron-right ms-1"></i></a>
                        </div>
                    </div>
                    <div class="stat-card patients">
                        <h6>Total Pasien</h6>
                        <div class="value" id="totalPasien">0</div>
                        <div class="mt-2">
                            <a href="#" class="text-white" id="viewPasienLink">View Details <i class="fas fa-chevron-right ms-1"></i></a>
                        </div>
                    </div>
                    <div class="stat-card records">
                        <h6>Total Rekam Medis</h6>
                        <div class="value" id="totalRekamMedis">0</div>
                        <div class="mt-2">
                            <a href="#" class="text-white" id="viewRekamMedisLink">View Details <i class="fas fa-chevron-right ms-1"></i></a>
                        </div>
                    </div>
                    <div class="stat-card blocks">
                        <h6>Total Blocks</h6>
                        <div class="value" id="totalBlocks">0</div>
                        <div class="mt-2">
                            <a href="#" class="text-white" id="viewBlocksLink">View Details <i class="fas fa-chevron-right ms-1"></i></a>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-calendar-alt me-2"></i>Aktivitas Terbaru</h5>
                                <button class="btn btn-sm btn-outline-primary" id="refreshActivityBtn">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Waktu</th>
                                                <th>Aktivitas</th>
                                                <th>User</th>
                                            </tr>
                                        </thead>
                                        <tbody id="activityTableBody">
                                            <tr>
                                                <td colspan="3" class="text-center py-4">
                                                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                                                    <p class="mt-3">Loading activity...</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-link me-2"></i>Blockchain Status</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Chain Length:</span>
                                        <span class="badge bg-primary" id="chainLength">0</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Difficulty:</span>
                                        <span class="badge bg-info" id="difficulty">4</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Chain Valid:</span>
                                        <span class="badge bg-secondary" id="chainValid">Checking...</span>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Last Block Hash:</label>
                                    <div class="hash-display" id="lastBlockHash">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dokter Management Content -->
            <div id="dokterContent" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Manajemen Dokter</h2>
                    <button class="btn btn-primary" id="addDokterBtn">
                        <i class="fas fa-plus me-2"></i> Tambah Dokter
                    </button>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title"><i class="fas fa-user-md me-2"></i>Daftar Dokter</h5>
                        <div class="input-group" style="width: 300px;">
                            <input type="text" class="form-control" id="searchDokter" placeholder="Cari dokter...">
                            <button class="btn btn-outline-secondary" type="button" id="searchDokterBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="dokterTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nama</th>
                                        <th>Email</th>
                                        <th>Spesialis</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="dokterTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                                            <p class="mt-3">Loading data dokter...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Dokter pagination">
                            <ul class="pagination justify-content-center" id="dokterPagination">
                                <!-- Pagination will be added here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Pasien Management Content -->
            <div id="pasienContent" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Manajemen Pasien</h2>
                    <div class="input-group" style="width: 300px;">
                        <input type="text" class="form-control" id="searchPasien" placeholder="Cari pasien...">
                        <button class="btn btn-outline-secondary" type="button" id="searchPasienBtn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title"><i class="fas fa-users me-2"></i>Daftar Pasien</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover" id="pasienTable">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Nama</th>
                                        <th>Email</th>
                                        <th>Tanggal Lahir</th>
                                        <th>Rekam Medis</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="pasienTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                                            <p class="mt-3">Loading data pasien...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Pasien pagination">
                            <ul class="pagination justify-content-center" id="pasienPagination">
                                <!-- Pagination will be added here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Blockchain Explorer Content -->
            <div id="blockchainContent" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Blockchain Explorer</h2>
                    <button class="btn btn-outline-primary" id="refreshBlockchainBtn">
                        <i class="fas fa-sync-alt me-2"></i> Refresh
                    </button>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="card-title"><i class="fas fa-database me-2"></i>Blockchain Data</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3 input-group">
                            <input type="text" class="form-control" id="blockSearch" placeholder="Cari berdasarkan hash, ID rekam medis...">
                            <button class="btn btn-outline-secondary" type="button" id="blockSearchBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover" id="blockchainTable">
                                <thead>
                                    <tr>
                                        <th>Block #</th>
                                        <th>Timestamp</th>
                                        <th>Hash</th>
                                        <th>Previous Hash</th>
                                        <th>Data</th>
                                        <th>Nonce</th>
                                    </tr>
                                </thead>
                                <tbody id="blockchainTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center py-4">
                                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                                            <p class="mt-3">Loading blockchain data...</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav aria-label="Blockchain pagination">
                            <ul class="pagination justify-content-center" id="blockchainPagination">
                                <!-- Pagination will be added here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Settings Content -->
            <div id="settingsContent" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Pengaturan Sistem</h2>
                </div>
                
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-link me-2"></i>Konfigurasi Blockchain</h5>
                            </div>
                            <div class="card-body">
                                <form id="blockchainConfigForm">
                                    <div class="mb-3">
                                        <label for="difficultyInput" class="form-label">Kesulitan Mining (Proof-of-Work)</label>
                                        <input type="number" class="form-control" id="difficultyInput" min="1" max="6" required>
                                        <div class="form-text">Semakin tinggi nilai, semakin lama waktu yang dibutuhkan untuk mining block.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="miningReward" class="form-label">Mining Reward</label>
                                        <input type="number" class="form-control" id="miningReward" step="0.01" min="0" required>
                                        <div class="form-text">Reward untuk miner (jika menggunakan token).</div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i> Simpan Pengaturan
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="card-title"><i class="fas fa-shield-alt me-2"></i>Keamanan Sistem</h5>
                            </div>
                            <div class="card-body">
                                <form id="securityConfigForm">
                                    <div class="mb-3">
                                        <label for="sessionTimeout" class="form-label">Session Timeout (menit)</label>
                                        <input type="number" class="form-control" id="sessionTimeout" min="5" max="1440" required>
                                        <div class="form-text">Waktu sebelum sesi pengguna berakhir karena tidak aktif.</div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="passwordComplexity" class="form-label">Kompleksitas Password</label>
                                        <select class="form-select" id="passwordComplexity" required>
                                            <option value="1">Low (min. 6 karakter)</option>
                                            <option value="2">Medium (min. 8 karakter, huruf dan angka)</option>
                                            <option value="3">High (min. 10 karakter, huruf besar/kecil, angka, dan simbol)</option>
                                        </select>
                                    </div>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-2"></i> Simpan Pengaturan
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Dokter Modal -->
    <div class="modal fade" id="dokterModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="dokterModalTitle">Tambah Dokter Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="dokterForm">
                        <div class="mb-3">
                            <label for="dokterName" class="form-label">Nama Lengkap <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="dokterName" required>
                        </div>
                        <div class="mb-3">
                            <label for="dokterEmail" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="dokterEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="dokterSpesialis" class="form-label">Spesialisasi <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="dokterSpesialis" required>
                        </div>
                        <div class="mb-3">
                            <label for="dokterPassword" class="form-label">Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="dokterPassword" required>
                            <div class="form-text">Minimal 8 karakter</div>
                        </div>
                        <div class="mb-3" id="confirmPasswordField">
                            <label for="dokterConfirmPassword" class="form-label">Konfirmasi Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="dokterConfirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveDokterBtn">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Pasien Modal -->
    <div class="modal fade" id="viewPasienModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Pasien</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title"><i class="fas fa-user-circle me-2"></i>Informasi Pasien</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Nama:</strong> <span id="viewPasienName"></span></p>
                                    <p><strong>Email:</strong> <span id="viewPasienEmail"></span></p>
                                    <p><strong>Tanggal Lahir:</strong> <span id="viewPasienDob"></span></p>
                                    <p><strong>ID Pasien:</strong> <span id="viewPasienId" class="text-muted"></span></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="card-title"><i class="fas fa-file-medical me-2"></i>Rekam Medis</h5>
                                    <div class="badge bg-primary rounded-pill" id="totalRecordsBadge">0 records</div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Tanggal</th>
                                                    <th>Dokter</th>
                                                    <th>Diagnosa</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="pasienRekamMedisBody">
                                                <!-- Data akan diisi oleh JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Rekam Medis Modal -->
    <div class="modal fade" id="viewRekamMedisModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Rekam Medis</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title"><i class="fas fa-file-alt me-2"></i>Informasi Medis</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Tanggal:</strong> <span id="rekamMedisTanggal"></span></p>
                                    <p><strong>Dokter:</strong> <span id="rekamMedisDokter"></span></p>
                                    <p><strong>Diagnosa:</strong> <span id="rekamMedisDiagnosa"></span></p>
                                    <p><strong>Tindakan:</strong> <span id="rekamMedisTindakan"></span></p>
                                    <p><strong>Catatan:</strong> <span id="rekamMedisCatatan"></span></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title"><i class="fas fa-link me-2"></i>Blockchain Data</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Block Hash:</strong> <span id="rekamMedisHash" class="hash-display d-block"></span></p>
                                    <p><strong>Block Timestamp:</strong> <span id="rekamMedisBlockTime"></span></p>
                                    <p><strong>Block Index:</strong> <span id="rekamMedisBlockIndex"></span></p>
                                    <p><strong>Nonce:</strong> <span id="rekamMedisNonce"></span></p>
                                    <p><strong>Previous Hash:</strong> <span id="rekamMedisPrevHash" class="hash-display d-block"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Block Modal -->
    <div class="modal fade" id="viewBlockModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Block #<span id="blockIndexTitle"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="card-title"><i class="fas fa-info-circle me-2"></i>Block Information</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Index:</strong> <span id="blockIndex"></span></p>
                                    <p><strong>Timestamp:</strong> <span id="blockTimestamp"></span></p>
                                    <p><strong>Nonce:</strong> <span id="blockNonce"></span></p>
                                    <p><strong>Difficulty:</strong> <span id="blockDifficulty"></span></p>
                                    <p><strong>Valid:</strong> <span id="blockValid" class="badge"></span></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title"><i class="fas fa-hashtag me-2"></i>Hash Information</h5>
                                </div>
                                <div class="card-body">
                                    <p><strong>Current Hash:</strong> <span id="blockHash" class="hash-display d-block"></span></p>
                                    <p><strong>Previous Hash:</strong> <span id="blockPrevHash" class="hash-display d-block"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title"><i class="fas fa-database me-2"></i>Block Data</h5>
                        </div>
                        <div class="card-body">
                            <pre id="blockData" class="bg-light p-3 rounded" style="max-height: 300px; overflow: auto;"></pre>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mining Modal -->
    <div class="modal fade" id="miningModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mining Block</h5>
                </div>
                <div class="modal-body">
                    <div class="progress mb-3">
                        <div id="miningProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                    </div>
                    <p id="miningStatus" class="text-center">Memulai proses mining...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Profil Admin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="profileForm">
                        <div class="mb-3">
                            <label for="profileName" class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" id="profileName" required>
                        </div>
                        <div class="mb-3">
                            <label for="profileEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="profileEmail" disabled>
                        </div>
                        <div class="mb-3">
                            <label for="profilePassword" class="form-label">Password Baru (biarkan kosong jika tidak ingin mengubah)</label>
                            <input type="password" class="form-control" id="profilePassword">
                        </div>
                        <div class="mb-3">
                            <label for="profileConfirmPassword" class="form-label">Konfirmasi Password Baru</label>
                            <input type="password" class="form-control" id="profileConfirmPassword">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="saveProfileBtn">Simpan Perubahan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalTitle">Konfirmasi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirmationModalBody">
                    Apakah Anda yakin ingin melanjutkan?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-danger" id="confirmActionBtn">Ya, Lanjutkan</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD1EaxhFilcZz37g26ymtK9CYt7fKKnCRw",
            authDomain: "aplikasi-medis-block-cain.firebaseapp.com",
            projectId: "aplikasi-medis-block-cain",
            storageBucket: "aplikasi-medis-block-cain.appspot.com",
            messagingSenderId: "244107019673",
            appId: "1:244107019673:web:70afe77184d7ea42e73f08",
            measurementId: "G-EL99THSXXN"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Blockchain class implementation
        class Block {
            constructor(index, timestamp, data, previousHash = '') {
                this.index = index;
                this.timestamp = timestamp;
                this.data = data;
                this.previousHash = previousHash;
                this.hash = this.calculateHash();
                this.nonce = 0;
            }

            calculateHash() {
                return CryptoJS.SHA256(
                    this.index + 
                    this.previousHash + 
                    this.timestamp + 
                    JSON.stringify(this.data) + 
                    this.nonce
                ).toString();
            }

            mineBlock(difficulty) {
                const startTime = new Date().getTime();
                
                // Show mining progress in modal
                const miningModal = new bootstrap.Modal(document.getElementById('miningModal'));
                const miningProgress = document.getElementById('miningProgress');
                const miningStatus = document.getElementById('miningStatus');
                
                miningModal.show();
                
                const updateInterval = setInterval(() => {
                    const elapsed = (new Date().getTime() - startTime) / 1000;
                    miningStatus.textContent = `Mencari nonce yang valid... (${this.nonce} percobaan, ${elapsed.toFixed(1)} detik)`;
                    
                    // Simulate progress (not accurate, just for UI)
                    const progress = Math.min(95, (this.nonce % 100) * 1.5);
                    miningProgress.style.width = `${progress}%`;
                }, 100);
                
                // Mine block
                while (this.hash.substring(0, difficulty) !== Array(difficulty + 1).join("0")) {
                    this.nonce++;
                    this.hash = this.calculateHash();
                }
                
                // Complete mining
                clearInterval(updateInterval);
                miningProgress.style.width = '100%';
                miningStatus.textContent = 'Block berhasil ditambahkan ke blockchain!';
                
                setTimeout(() => {
                    miningModal.hide();
                }, 1000);
                
                console.log("Block mined: " + this.hash);
            }
        }

        class Blockchain {
            constructor() {
                this.chain = [this.createGenesisBlock()];
                this.difficulty = 4;
                this.pendingRecords = [];
                this.miningReward = 0.01;
            }

            createGenesisBlock() {
                return new Block(0, new Date().toISOString(), "Genesis block", "0");
            }

            getLatestBlock() {
                return this.chain[this.chain.length - 1];
            }

            addRecord(record) {
                this.pendingRecords.push(record);
            }

            minePendingRecords(miningRewardAddress) {
                // Create a new block with all pending records
                let block = new Block(
                    this.chain.length,
                    new Date().toISOString(),
                    this.pendingRecords,
                    this.getLatestBlock().hash
                );
                
                // Mine the block
                block.mineBlock(this.difficulty);
                
                // Add the block to the chain
                this.chain.push(block);
                
                // Reset pending records and give mining reward
                this.pendingRecords = [];
                
                // In a real blockchain, you would create a new transaction for the mining reward
                console.log(`Mining reward of ${this.miningReward} sent to ${miningRewardAddress}`);
                
                return block;
            }

            isChainValid() {
                for (let i = 1; i < this.chain.length; i++) {
                    const currentBlock = this.chain[i];
                    const previousBlock = this.chain[i - 1];

                    // Check if current block hash is valid
                    if (currentBlock.hash !== currentBlock.calculateHash()) {
                        return false;
                    }

                    // Check if previous hash matches
                    if (currentBlock.previousHash !== previousBlock.hash) {
                        return false;
                    }
                }
                return true;
            }

            getBalanceOfAddress(address) {
                let balance = 0;
                
                // Loop through all blocks and transactions
                for (const block of this.chain) {
                    if (block.data && Array.isArray(block.data)) {
                        for (const trans of block.data) {
                            if (trans.fromAddress === address) {
                                balance -= trans.amount;
                            }
                            
                            if (trans.toAddress === address) {
                                balance += trans.amount;
                            }
                        }
                    }
                }
                
                return balance;
            }
        }

        // Initialize blockchain
        let medicalBlockchain = new Blockchain();

        // Global variables
        let currentUser = null;
        let currentUserData = null;
        let blockchainChart = null;

        // DOM Content Loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sidebar toggle
            const menuToggle = document.getElementById('menu-toggle');
            if (menuToggle) {
                menuToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelector('.sidebar').classList.toggle('active');
                });
            }
            
            // Set current date
            document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
            
            // Initialize navigation
            setupNavigation();
            
            // Initialize blockchain
            initBlockchain();
            
            // Initialize auth state listener
            initAuth();
            
            // Initialize event listeners
            initEventListeners();
        });

        function initBlockchain() {
            loadBlockchainFromFirestore().then(blockchain => {
                medicalBlockchain = blockchain;
                updateBlockchainStatus();
                
                // Load data for current page
                if (document.getElementById('dashboardContent').style.display !== 'none') {
                    loadAdminDashboardData();
                } else if (document.getElementById('dokterContent').style.display !== 'none') {
                    loadDokterData();
                } else if (document.getElementById('pasienContent').style.display !== 'none') {
                    loadPasienData();
                } else if (document.getElementById('blockchainContent').style.display !== 'none') {
                    updateBlockchainTable();
                }
            });
        }

        function loadBlockchainFromFirestore() {
            return db.collection('blockchain').orderBy('index').get()
                .then(querySnapshot => {
                    if (querySnapshot.empty) {
                        // No blockchain in Firestore, initialize with genesis block
                        return saveBlockToFirestore(medicalBlockchain.chain[0]).then(() => medicalBlockchain);
                    } else {
                        // Load blockchain from Firestore
                        medicalBlockchain.chain = [];
                        querySnapshot.forEach(doc => {
                            const blockData = doc.data();
                            const block = new Block(
                                blockData.index,
                                blockData.timestamp,
                                blockData.data,
                                blockData.previousHash
                            );
                            block.hash = blockData.hash;
                            block.nonce = blockData.nonce;
                            medicalBlockchain.chain.push(block);
                        });
                        
                        // Set difficulty and mining reward from the last block or default
                        if (querySnapshot.docs.length > 0) {
                            const lastBlock = querySnapshot.docs[querySnapshot.docs.length - 1].data();
                            medicalBlockchain.difficulty = lastBlock.difficulty || 4;
                            medicalBlockchain.miningReward = lastBlock.miningReward || 0.01;
                        }
                        
                        console.log('Blockchain loaded from Firestore:', medicalBlockchain);
                        return medicalBlockchain;
                    }
                })
                .catch(error => {
                    console.error("Error loading blockchain:", error);
                    return medicalBlockchain;
                });
        }

        function saveBlockToFirestore(block) {
            return db.collection('blockchain').doc(block.index.toString()).set({
                index: block.index,
                timestamp: block.timestamp,
                data: block.data,
                previousHash: block.previousHash,
                hash: block.hash,
                nonce: block.nonce,
                difficulty: medicalBlockchain.difficulty,
                miningReward: medicalBlockchain.miningReward
            });
        }

        function initAuth() {
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    
                    // Get user data from Firestore
                    db.collection('users').doc(user.uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                currentUserData = doc.data();
                                
                                // Check if user is admin
                                if (currentUserData.role !== 'ADMIN') {
                                    // Redirect to login page if not admin
                                    window.location.href = 'index.html';
                                }
                                
                                // Update UI
                                updateUIForUser();
                            } else {
                                console.log("No user data found!");
                                auth.signOut();
                            }
                        })
                        .catch(error => {
                            console.log("Error getting user data:", error);
                            auth.signOut();
                        });
                } else {
                    // User is signed out, redirect to login
                    window.location.href = 'index.html';
                }
            });
        }

        function updateUIForUser() {
            // Profile link
            document.getElementById('profileLink').addEventListener('click', function(e) {
                e.preventDefault();
                showProfileModal();
            });
            
            // Logout link
            document.getElementById('logoutDropdown').addEventListener('click', function(e) {
                e.preventDefault();
                auth.signOut().then(() => {
                    window.location.href = 'index.html';
                });
            });
            
            // Save profile button
            document.getElementById('saveProfileBtn').addEventListener('click', updateProfile);
        }

        function showProfileModal() {
            const modal = new bootstrap.Modal(document.getElementById('profileModal'));
            
            // Fill form with user data
            document.getElementById('profileName').value = currentUserData.nama || '';
            document.getElementById('profileEmail').value = currentUser.email;
            
            modal.show();
        }

        function updateProfile() {
            const name = document.getElementById('profileName').value;
            const newPassword = document.getElementById('profilePassword').value;
            const confirmPassword = document.getElementById('profileConfirmPassword').value;
            
            // Validate passwords if changed
            if (newPassword && newPassword !== confirmPassword) {
                alert('Password baru tidak cocok!');
                return;
            }
            
            // Update profile in Firestore
            const updates = {
                nama: name,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('users').doc(currentUser.uid).update(updates)
                .then(() => {
                    // Update password if provided
                    if (newPassword) {
                        return currentUser.updatePassword(newPassword);
                    }
                })
                .then(() => {
                    alert('Profil berhasil diperbarui!');
                    bootstrap.Modal.getInstance(document.getElementById('profileModal')).hide();
                })
                .catch(error => {
                    console.error("Error updating profile:", error);
                    alert('Gagal memperbarui profil: ' + error.message);
                });
        }

        function initEventListeners() {
            // Refresh buttons
            document.getElementById('refreshActivityBtn')?.addEventListener('click', loadRecentActivity);
            document.getElementById('refreshBlockchainBtn')?.addEventListener('click', updateBlockchainTable);
            
            // Dokter management
            document.getElementById('addDokterBtn')?.addEventListener('click', showAddDokterModal);
            document.getElementById('saveDokterBtn')?.addEventListener('click', saveDokter);
            
            // Search functionality
            document.getElementById('searchDokterBtn')?.addEventListener('click', searchDokter);
            document.getElementById('searchPasienBtn')?.addEventListener('click', searchPasien);
            document.getElementById('blockSearchBtn')?.addEventListener('click', searchBlockchain);
            
            // Settings form
            document.getElementById('blockchainConfigForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                saveBlockchainConfig();
            });
            
            // Quick links from dashboard cards
            document.getElementById('viewDokterLink')?.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('dokterLink').click();
            });
            
            document.getElementById('viewPasienLink')?.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('pasienLink').click();
            });
            
            document.getElementById('viewRekamMedisLink')?.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('blockchainLink').click();
            });
            
            document.getElementById('viewBlocksLink')?.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('blockchainLink').click();
            });
        }

        function setupNavigation() {
            const navLinks = [
                { id: 'dashboardLink', contentId: 'dashboardContent' },
                { id: 'dokterLink', contentId: 'dokterContent' },
                { id: 'pasienLink', contentId: 'pasienContent' },
                { id: 'blockchainLink', contentId: 'blockchainContent' },
                { id: 'settingsLink', contentId: 'settingsContent' },
                { id: 'logoutLink', contentId: 'logout' }
            ];
            
            navLinks.forEach(link => {
                const navElement = document.getElementById(link.id);
                if (navElement) {
                    navElement.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        if (link.id === 'logoutLink') {
                            auth.signOut();
                            return;
                        }
                        
                        // Hide all content sections
                        document.querySelectorAll('.content > div[id$="Content"]').forEach(section => {
                            section.style.display = 'none';
                        });
                        
                        // Show selected content
                        document.getElementById(link.contentId).style.display = 'block';
                        
                        // Update active nav link
                        document.querySelectorAll('.menu-item').forEach(item => {
                            item.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // Update navbar title
                        let title = 'Dashboard';
                        switch(link.contentId) {
                            case 'dokterContent': title = 'Manajemen Dokter'; break;
                            case 'pasienContent': title = 'Manajemen Pasien'; break;
                            case 'blockchainContent': title = 'Blockchain Explorer'; break;
                            case 'settingsContent': title = 'Pengaturan Sistem'; break;
                        }
                        document.querySelector('.navbar-brand').textContent = title;
                        
                        // Load data for the selected section
                        switch(link.contentId) {
                            case 'dashboardContent':
                                loadAdminDashboardData();
                                break;
                            case 'dokterContent':
                                loadDokterData();
                                break;
                            case 'pasienContent':
                                loadPasienData();
                                break;
                            case 'blockchainContent':
                                updateBlockchainTable();
                                break;
                            case 'settingsContent':
                                loadSettings();
                                break;
                        }
                    });
                }
            });
        }

        function loadAdminDashboardData() {
            // Load counts
            Promise.all([
                db.collection('users').where('role', '==', 'DOKTER').get(),
                db.collection('users').where('role', '==', 'PASIEN').get()
            ]).then(([dokterSnapshot, pasienSnapshot]) => {
                document.getElementById('totalDokter').textContent = dokterSnapshot.size;
                document.getElementById('totalPasien').textContent = pasienSnapshot.size;
                
                // Count medical records (from blockchain)
                let recordCount = 0;
                for (const block of medicalBlockchain.chain) {
                    if (block.data && Array.isArray(block.data)) {
                        recordCount += block.data.length;
                    }
                }
                document.getElementById('totalRekamMedis').textContent = recordCount;
                
                // Blockchain info
                document.getElementById('totalBlocks').textContent = medicalBlockchain.chain.length;
                
                // Load recent activity
                loadRecentActivity();
            }).catch(error => {
                console.error("Error loading dashboard data:", error);
            });
        }

        function loadRecentActivity() {
            const activityTableBody = document.getElementById('activityTableBody');
            activityTableBody.innerHTML = '';
            
            // Get last 5 blocks and their records
            const recentBlocks = [...medicalBlockchain.chain].reverse().slice(0, 5);
            
            if (recentBlocks.length === 0) {
                activityTableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center py-4">
                            <i class="fas fa-info-circle" style="font-size: 2rem; color: #7f8c8d;"></i>
                            <p class="mt-2">Tidak ada aktivitas terbaru</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let activityCount = 0;
            for (const block of recentBlocks) {
                if (block.data && Array.isArray(block.data)) {
                    block.data.forEach(record => {
                        if (activityCount >= 10) return;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${new Date(block.timestamp).toLocaleString()}</td>
                            <td>Rekam medis baru untuk pasien</td>
                            <td>${record.dokter_nama || 'Dokter'}</td>
                        `;
                        activityTableBody.appendChild(row);
                        activityCount++;
                    });
                }
            }
            
            if (activityCount === 0) {
                activityTableBody.innerHTML = `
                    <tr>
                        <td colspan="3" class="text-center py-4">
                            <i class="fas fa-info-circle" style="font-size: 2rem; color: #7f8c8d;"></i>
                            <p class="mt-2">Tidak ada aktivitas terbaru</p>
                        </td>
                    </tr>
                `;
            }
        }

        function updateBlockchainStatus() {
            document.getElementById('chainLength').textContent = medicalBlockchain.chain.length;
            document.getElementById('lastBlockHash').textContent = medicalBlockchain.getLatestBlock().hash;
            
            const isValid = medicalBlockchain.isChainValid();
            const validBadge = document.getElementById('chainValid');
            validBadge.textContent = isValid ? 'Valid' : 'Invalid';
            validBadge.className = isValid ? 'badge bg-success' : 'badge bg-danger';
            
            document.getElementById('difficulty').textContent = medicalBlockchain.difficulty;
        }

        function loadDokterData(searchTerm = '') {
            const tableBody = document.getElementById('dokterTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-3">Loading data dokter...</p>
                    </td>
                </tr>
            `;
            
            let query = db.collection('users').where('role', '==', 'DOKTER');
            
            if (searchTerm) {
                query = query.where('nama', '>=', searchTerm).where('nama', '<=', searchTerm + '\uf8ff');
            }
            
            query.get()
                .then(querySnapshot => {
                    tableBody.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" class="text-center py-4">
                                    <i class="fas fa-user-md" style="font-size: 2rem; color: #7f8c8d;"></i>
                                    <p class="mt-2">Tidak ada data dokter ditemukan</p>
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    querySnapshot.forEach(doc => {
                        const dokter = doc.data();
                        const row = document.createElement('tr');
                        
                        row.innerHTML = `
                            <td class="text-truncate" style="max-width: 150px;">${doc.id}</td>
                            <td>${dokter.nama}</td>
                            <td>${dokter.email}</td>
                            <td>${dokter.spesialis || '-'}</td>
                            <td><span class="badge bg-success">Aktif</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary edit-dokter-btn" data-id="${doc.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger delete-dokter-btn" data-id="${doc.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    // Add event listeners to buttons
                    document.querySelectorAll('.edit-dokter-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            editDokter(this.getAttribute('data-id'));
                        });
                    });
                    
                    document.querySelectorAll('.delete-dokter-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            showDeleteConfirmation(this.getAttribute('data-id'));
                        });
                    });
                })
                .catch(error => {
                    console.error("Error loading dokter data:", error);
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-4 text-danger">
                                Gagal memuat data dokter. Silakan coba lagi.
                            </td>
                        </tr>
                    `;
                });
        }

        function showAddDokterModal() {
            const modal = new bootstrap.Modal(document.getElementById('dokterModal'));
            document.getElementById('dokterModalTitle').textContent = 'Tambah Dokter Baru';
            document.getElementById('dokterForm').reset();
            document.getElementById('confirmPasswordField').style.display = 'block';
            document.getElementById('saveDokterBtn').textContent = 'Simpan';
            document.getElementById('saveDokterBtn').onclick = saveDokter;
            modal.show();
        }

        function saveDokter() {
            const name = document.getElementById('dokterName').value;
            const email = document.getElementById('dokterEmail').value;
            const spesialis = document.getElementById('dokterSpesialis').value;
            const password = document.getElementById('dokterPassword').value;
            const confirmPassword = document.getElementById('dokterConfirmPassword').value;
            
            // Validate form
            if (!name || !email || !spesialis || !password || !confirmPassword) {
                alert('Harap isi semua field yang wajib diisi!');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Password dan konfirmasi password tidak cocok!');
                return;
            }
            
            if (password.length < 8) {
                alert('Password harus minimal 8 karakter!');
                return;
            }
            
            // Create auth user first
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    
                    // Add user data to Firestore
                    return db.collection('users').doc(user.uid).set({
                        nama: name,
                        email: email,
                        spesialis: spesialis,
                        role: 'DOKTER',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                })
                .then(() => {
                    alert('Dokter berhasil ditambahkan!');
                    bootstrap.Modal.getInstance(document.getElementById('dokterModal')).hide();
                    loadDokterData();
                })
                .catch(error => {
                    console.error("Error adding dokter:", error);
                    alert('Gagal menambahkan dokter: ' + error.message);
                });
        }

        function editDokter(dokterId) {
            db.collection('users').doc(dokterId).get()
                .then(doc => {
                    if (doc.exists) {
                        const dokter = doc.data();
                        
                        // Fill form
                        document.getElementById('dokterName').value = dokter.nama;
                        document.getElementById('dokterEmail').value = dokter.email;
                        document.getElementById('dokterSpesialis').value = dokter.spesialis || '';
                        
                        // Hide password fields for edit
                        document.getElementById('confirmPasswordField').style.display = 'none';
                        
                        // Change modal title and button
                        document.getElementById('dokterModalTitle').textContent = 'Edit Dokter';
                        document.getElementById('saveDokterBtn').textContent = 'Update';
                        
                        // Change save handler to update
                        document.getElementById('saveDokterBtn').onclick = function() {
                            updateDokter(dokterId);
                        };
                        
                        // Show modal
                        const modal = new bootstrap.Modal(document.getElementById('dokterModal'));
                        modal.show();
                    }
                })
                .catch(error => {
                    console.error("Error getting dokter:", error);
                    alert('Gagal memuat data dokter: ' + error.message);
                });
        }

        function updateDokter(dokterId) {
            const name = document.getElementById('dokterName').value;
            const email = document.getElementById('dokterEmail').value;
            const spesialis = document.getElementById('dokterSpesialis').value;
            const password = document.getElementById('dokterPassword').value;
            
            // Validate form
            if (!name || !email || !spesialis) {
                alert('Harap isi semua field yang wajib diisi!');
                return;
            }
            
            // Update user data in Firestore
            const updates = {
                nama: name,
                email: email,
                spesialis: spesialis,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            const promises = [db.collection('users').doc(dokterId).update(updates)];
            
            // Update password if provided
            if (password) {
                if (password.length < 8) {
                    alert('Password harus minimal 8 karakter!');
                    return;
                }
                
                promises.push(auth.updateUser(dokterId, {
                    email: email,
                    password: password
                }));
            } else {
                promises.push(auth.updateUser(dokterId, {
                    email: email
                }));
            }
            
            Promise.all(promises)
                .then(() => {
                    alert('Dokter berhasil diperbarui!');
                    bootstrap.Modal.getInstance(document.getElementById('dokterModal')).hide();
                    loadDokterData();
                })
                .catch(error => {
                    console.error("Error updating dokter:", error);
                    alert('Gagal memperbarui dokter: ' + error.message);
                });
        }

        function showDeleteConfirmation(dokterId) {
            const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            document.getElementById('confirmationModalTitle').textContent = 'Hapus Dokter';
            document.getElementById('confirmationModalBody').textContent = 'Apakah Anda yakin ingin menghapus dokter ini? Tindakan ini tidak dapat dibatalkan.';
            
            document.getElementById('confirmActionBtn').onclick = function() {
                deleteDokter(dokterId);
                confirmationModal.hide();
            };
            
            confirmationModal.show();
        }

        function deleteDokter(dokterId) {
            // Delete from Firestore
            db.collection('users').doc(dokterId).delete()
                .then(() => {
                    // Delete auth user
                    return auth.deleteUser(dokterId);
                })
                .then(() => {
                    alert('Dokter berhasil dihapus!');
                    loadDokterData();
                })
                .catch(error => {
                    console.error("Error deleting dokter:", error);
                    alert('Gagal menghapus dokter: ' + error.message);
                });
        }

        function searchDokter() {
            const searchTerm = document.getElementById('searchDokter').value.trim();
            loadDokterData(searchTerm);
        }

        function loadPasienData(searchTerm = '') {
            const tableBody = document.getElementById('pasienTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-3">Loading data pasien...</p>
                    </td>
                </tr>
            `;
            
            let query = db.collection('users').where('role', '==', 'PASIEN');
            
            if (searchTerm) {
                query = query.where('nama', '>=', searchTerm).where('nama', '<=', searchTerm + '\uf8ff');
            }
            
            query.get()
                .then(querySnapshot => {
                    tableBody.innerHTML = '';
                    
                    if (querySnapshot.empty) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" class="text-center py-4">
                                    <i class="fas fa-users" style="font-size: 2rem; color: #7f8c8d;"></i>
                                    <p class="mt-2">Tidak ada data pasien ditemukan</p>
                                </td>
                            </tr>
                        `;
                        return;
                    }
                    
                    querySnapshot.forEach(doc => {
                        const pasien = doc.data();
                        const records = getPatientRecords(doc.id);
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td class="text-truncate" style="max-width: 150px;">${doc.id}</td>
                            <td>${pasien.nama}</td>
                            <td>${pasien.email}</td>
                            <td>${pasien.tgl_lahir || '-'}</td>
                            <td><span class="badge bg-primary">${records.length}</span></td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary view-pasien-btn" data-id="${doc.id}">
                                    <i class="fas fa-eye me-1"></i> View
                                </button>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                    
                    // Add event listeners to view buttons
                    document.querySelectorAll('.view-pasien-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            viewPasienDetails(this.getAttribute('data-id'));
                        });
                    });
                })
                .catch(error => {
                    console.error("Error loading pasien data:", error);
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-4 text-danger">
                                Gagal memuat data pasien. Silakan coba lagi.
                            </td>
                        </tr>
                    `;
                });
        }

        function searchPasien() {
            const searchTerm = document.getElementById('searchPasien').value.trim();
            loadPasienData(searchTerm);
        }

        function viewPasienDetails(pasienId) {
            db.collection('users').doc(pasienId).get()
                .then(doc => {
                    if (doc.exists) {
                        const pasien = doc.data();
                        
                        // Fill patient info
                        document.getElementById('viewPasienName').textContent = pasien.nama;
                        document.getElementById('viewPasienEmail').textContent = pasien.email;
                        document.getElementById('viewPasienDob').textContent = pasien.tgl_lahir || '-';
                        document.getElementById('viewPasienId').textContent = pasienId;
                        
                        // Load patient's medical records
                        const records = getPatientRecords(pasienId);
                        const recordsBody = document.getElementById('pasienRekamMedisBody');
                        recordsBody.innerHTML = '';
                        
                        document.getElementById('totalRecordsBadge').textContent = `${records.length} records`;
                        
                        if (records.length === 0) {
                            recordsBody.innerHTML = `
                                <tr>
                                    <td colspan="4" class="text-center py-4">
                                        <i class="fas fa-file-medical" style="font-size: 2rem; color: #7f8c8d;"></i>
                                        <p class="mt-2">Tidak ada rekam medis ditemukan</p>
                                    </td>
                                </tr>
                            `;
                        } else {
                            records.forEach(record => {
                                const row = document.createElement('tr');
                                
                                row.innerHTML = `
                                    <td>${new Date(record.tanggal).toLocaleString()}</td>
                                    <td>${record.dokter_nama}</td>
                                    <td>${record.diagnosa.substring(0, 50)}${record.diagnosa.length > 50 ? '...' : ''}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary view-rekam-medis-btn" 
                                            data-diagnosa="${record.diagnosa}" 
                                            data-tindakan="${record.tindakan}" 
                                            data-catatan="${record.catatan || ''}" 
                                            data-tanggal="${record.tanggal}" 
                                            data-dokter="${record.dokter_nama}"
                                            data-hash="${record.blockHash}"
                                            data-timestamp="${record.blockTimestamp}"
                                            data-nonce="${record.nonce || 0}"
                                            data-prevhash="${record.blockPrevHash || ''}"
                                            data-index="${record.blockIndex || 0}">
                                            <i class="fas fa-eye me-1"></i> Details
                                        </button>
                                    </td>
                                `;
                                
                                recordsBody.appendChild(row);
                            });
                            
                            // Add event listeners to view record buttons
                            document.querySelectorAll('.view-rekam-medis-btn').forEach(btn => {
                                btn.addEventListener('click', function() {
                                    showRekamMedisDetails(this);
                                });
                            });
                        }
                        
                        // Show modal
                        const modal = new bootstrap.Modal(document.getElementById('viewPasienModal'));
                        modal.show();
                    }
                })
                .catch(error => {
                    console.error("Error getting pasien:", error);
                    alert('Gagal memuat detail pasien: ' + error.message);
                });
        }

        function showRekamMedisDetails(button) {
            document.getElementById('rekamMedisTanggal').textContent = new Date(button.getAttribute('data-tanggal')).toLocaleString();
            document.getElementById('rekamMedisDokter').textContent = button.getAttribute('data-dokter');
            document.getElementById('rekamMedisDiagnosa').textContent = button.getAttribute('data-diagnosa');
            document.getElementById('rekamMedisTindakan').textContent = button.getAttribute('data-tindakan');
            document.getElementById('rekamMedisCatatan').textContent = button.getAttribute('data-catatan') || '-';
            document.getElementById('rekamMedisHash').textContent = button.getAttribute('data-hash');
            document.getElementById('rekamMedisBlockTime').textContent = new Date(button.getAttribute('data-timestamp')).toLocaleString();
            document.getElementById('rekamMedisNonce').textContent = button.getAttribute('data-nonce');
            document.getElementById('rekamMedisPrevHash').textContent = button.getAttribute('data-prevhash');
            document.getElementById('rekamMedisBlockIndex').textContent = button.getAttribute('data-index');
            
            const modal = new bootstrap.Modal(document.getElementById('viewRekamMedisModal'));
            modal.show();
        }

        function getPatientRecords(patientId) {
            const records = [];
            
            for (const block of medicalBlockchain.chain) {
                if (block.data && Array.isArray(block.data)) {
                    for (const record of block.data) {
                        if (record.pasien_id === patientId) {
                            records.push({
                                ...record,
                                blockIndex: block.index,
                                blockTimestamp: block.timestamp,
                                blockHash: block.hash,
                                blockPrevHash: block.previousHash,
                                nonce: block.nonce
                            });
                        }
                    }
                }
            }
            
            // Sort by date (newest first)
            records.sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            
            return records;
        }

        function updateBlockchainTable(searchTerm = '') {
            const tableBody = document.getElementById('blockchainTableBody');
            tableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center py-4">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-3">Loading blockchain data...</p>
                    </td>
                </tr>
            `;
            
            setTimeout(() => {
                const blocks = [...medicalBlockchain.chain].reverse(); // Show latest first
                tableBody.innerHTML = '';
                
                if (blocks.length === 0) {
                    tableBody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <i class="fas fa-link" style="font-size: 2rem; color: #7f8c8d;"></i>
                                <p class="mt-2">Tidak ada block ditemukan</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                let displayedBlocks = blocks;
                
                // Filter by search term if provided
                if (searchTerm) {
                    displayedBlocks = blocks.filter(block => {
                        // Search in block hash
                        if (block.hash.includes(searchTerm)) return true;
                        
                        // Search in block data
                        if (block.data && Array.isArray(block.data)) {
                            return block.data.some(record => {
                                if (typeof record === 'object') {
                                    return Object.values(record).some(
                                        val => val && val.toString().toLowerCase().includes(searchTerm.toLowerCase())
                                    );
                                }
                                return false;
                            });
                        }
                        
                        return false;
                    });
                    
                    if (displayedBlocks.length === 0) {
                        tableBody.innerHTML = `
                            <tr>
                                <td colspan="6" class="text-center py-4">
                                    <i class="fas fa-search" style="font-size: 2rem; color: #7f8c8d;"></i>
                                    <p class="mt-2">Tidak ada block yang cocok dengan pencarian</p>
                                </td>
                            </tr>
                        `;
                        return;
                    }
                }
                
                displayedBlocks.forEach(block => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${block.index}</td>
                        <td>${new Date(block.timestamp).toLocaleString()}</td>
                        <td class="text-truncate" style="max-width: 150px;">${block.hash}</td>
                        <td class="text-truncate" style="max-width: 150px;">${block.previousHash}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary view-block-btn" data-index="${block.index}">
                                <i class="fas fa-eye me-1"></i> View
                            </button>
                        </td>
                        <td>${block.nonce}</td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-block-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const blockIndex = parseInt(this.getAttribute('data-index'));
                        const block = medicalBlockchain.chain.find(b => b.index === blockIndex);
                        
                        if (block) {
                            showBlockDetails(block);
                        }
                    });
                });
            }, 500); // Small delay for better UX
        }

        function searchBlockchain() {
            const searchTerm = document.getElementById('blockSearch').value.trim();
            updateBlockchainTable(searchTerm);
        }

        function showBlockDetails(block) {
            document.getElementById('blockIndexTitle').textContent = block.index;
            document.getElementById('blockIndex').textContent = block.index;
            document.getElementById('blockTimestamp').textContent = new Date(block.timestamp).toLocaleString();
            document.getElementById('blockNonce').textContent = block.nonce;
            document.getElementById('blockDifficulty').textContent = medicalBlockchain.difficulty;
            
            const isValid = block.hash === block.calculateHash() && 
                          (block.index === 0 || block.previousHash === medicalBlockchain.chain[block.index - 1].hash);
            
            const validBadge = document.getElementById('blockValid');
            validBadge.textContent = isValid ? 'Valid' : 'Invalid';
            validBadge.className = isValid ? 'badge bg-success' : 'badge bg-danger';
            
            document.getElementById('blockHash').textContent = block.hash;
            document.getElementById('blockPrevHash').textContent = block.previousHash;
            
            // Format block data for display
            let dataContent = block.data;
            if (typeof dataContent !== 'string') {
                try {
                    dataContent = JSON.stringify(dataContent, null, 2);
                } catch (e) {
                    dataContent = block.data.toString();
                }
            }
            document.getElementById('blockData').textContent = dataContent;
            
            const modal = new bootstrap.Modal(document.getElementById('viewBlockModal'));
            modal.show();
        }

        function loadSettings() {
            document.getElementById('difficultyInput').value = medicalBlockchain.difficulty;
            document.getElementById('miningReward').value = medicalBlockchain.miningReward;
            
            // Load other settings if needed
            document.getElementById('sessionTimeout').value = 30; // Default
            document.getElementById('passwordComplexity').value = 2; // Default medium
        }

        function saveBlockchainConfig() {
            const difficulty = parseInt(document.getElementById('difficultyInput').value);
            const miningReward = parseFloat(document.getElementById('miningReward').value);
            
            if (isNaN(difficulty) || difficulty < 1 || difficulty > 6) {
                alert('Kesulitan mining harus antara 1 dan 6!');
                return;
            }
            
            if (isNaN(miningReward) || miningReward < 0) {
                alert('Mining reward tidak valid!');
                return;
            }
            
            medicalBlockchain.difficulty = difficulty;
            medicalBlockchain.miningReward = miningReward;
            
            // Save to Firestore (update last block with new config)
            if (medicalBlockchain.chain.length > 0) {
                const lastBlock = medicalBlockchain.chain[medicalBlockchain.chain.length - 1];
                db.collection('blockchain').doc(lastBlock.index.toString()).update({
                    difficulty: difficulty,
                    miningReward: miningReward
                })
                .then(() => {
                    alert('Pengaturan blockchain berhasil disimpan!');
                    updateBlockchainStatus();
                })
                .catch(error => {
                    console.error("Error saving blockchain config:", error);
                    alert('Gagal menyimpan pengaturan: ' + error.message);
                });
            }
        }

        // Add medical record to blockchain (for testing/demo purposes)
        function addTestMedicalRecord() {
            const recordData = {
                pasien_id: 'test-patient-' + Math.floor(Math.random() * 1000),
                pasien_nama: 'Test Patient',
                dokter_id: 'test-doctor-' + Math.floor(Math.random() * 1000),
                dokter_nama: 'Test Doctor',
                tanggal: new Date().toISOString(),
                diagnosa: 'Test diagnosis ' + Math.floor(Math.random() * 100),
                tindakan: 'Test treatment',
                catatan: 'This is a test medical record'
            };
            
            addMedicalRecordToBlockchain(recordData).then(block => {
                console.log('Record added to block:', block);
                alert('Test medical record berhasil ditambahkan ke blockchain!');
                updateBlockchainTable();
                updateBlockchainStatus();
            }).catch(error => {
                console.error('Error adding test record:', error);
                alert('Gagal menambahkan test record: ' + error.message);
            });
        }

        function addMedicalRecordToBlockchain(recordData) {
            return new Promise((resolve, reject) => {
                // Add record to pending records
                medicalBlockchain.addRecord(recordData);
                
                // Mine the block (using the doctor's ID as mining reward address)
                const newBlock = medicalBlockchain.minePendingRecords(recordData.dokter_id);
                
                // Save the new block to Firestore
                saveBlockToFirestore(newBlock)
                    .then(() => {
                        console.log('Block saved to Firestore:', newBlock);
                        resolve(newBlock);
                    })
                    .catch(error => {
                        console.error('Error saving block to Firestore:', error);
                        reject(error);
                    });
            });
        }
    </script>
</body>
</html>